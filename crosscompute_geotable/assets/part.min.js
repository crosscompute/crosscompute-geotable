function get_geotable_adjective(e){var a="streets|light|dark|satellite|streets-satellite|wheatpaste|streets-basic|comic|outdoors|run-bike-hike|pencil|pirates|emerald|high-contrast".replace(/-/g,"[-_]");try{return RegExp("("+a+")_geotable").exec(e)[1].replace(/_/g,"-")}catch(e){return"streets"}}function draw_map(e,a){for(var t=e+"-map",o=e+"-table",r=L.mapbox.map(t,"mapbox."+get_geotable_adjective(e)),l=[],i=a[0],c=a[1],d=0;d<i.length;d++){var n,s=i[d],p=s[0],u=s[1],_=2==p||3==p,b=$.extend({color:"black",weight:_?5:2,opacity:.7,fillColor:_?"#c9302c":"#286090",fillOpacity:.5},c,s[2]);switch(p){case 1:n=L.circleMarker(u,b),b.radius_in_pixels&&n.setRadius(+b.radius_in_pixels),add_feature(l,n,d,o);break;case 2:b.color=b.fillColor,add_feature(l,n=L.polyline(u,b),d,o);break;case 3:b.color=b.fillColor;for(var g=0;g<u.length;g++)add_feature(l,n=L.polyline(u[g],b),d,o);break;case 4:add_feature(l,n=L.polygon(u,b),d,o);break;case 5:for(g=0;g<u.length;g++)add_feature(l,n=L.polygon(u[g],b),d,o)}}l.length&&r.fitBounds(L.featureGroup(l).addTo(r).getBounds(),{animate:!1}).on("click",function(){$("#"+o).hide()})}function add_feature(e,a,t,o){a.geotable={table_id:o,tbody_id:o.replace("-table","-row")+t},a.on("click",function(e){var a=this.geotable,t=$("#"+a.tbody_id).show();$("#"+a.table_id+" tbody").not(t).hide(),$("#"+a.table_id).show(),L.DomEvent.stopPropagation(e)}),e.push(a)}$(".geotable-upload").on("uploaded.ir",function(e,a){import_upload(e,a,CC.geotable.import_url,function(e,a){var t=a.find("script").text(),o=$.trim(t.replace(/'/g,'"').replace(/.* = /,"")).slice(0,-1);draw_map(a.attr("id"),$.parseJSON(o))})});
