function get_geotable_adjective(e){var a="streets|light|dark|satellite|streets-satellite|wheatpaste|streets-basic|comic|outdoors|run-bike-hike|pencil|pirates|emerald|high-contrast".replace(/-/g,"[-_]");try{return RegExp("("+a+")_geotable").exec(e)[1].replace(/_/g,"-")}catch(e){return"streets"}}function draw_map(e,a){var t=e+"-map",r=e+"-table";var o=L.mapbox.map(t).addLayer(L.mapbox.styleLayer("mapbox://styles/mapbox/"+get_geotable_adjective(e)+"-v11"));var i=[],l=a[0],d=a[1];for(var s=0;s<l.length;s++){var c,n=l[s],p=n[0],u=n[1],_=p==2||p==5,b=$.extend({color:"black",weight:_?5:2,opacity:.7,fillColor:_?"#c9302c":"#286090",fillOpacity:.5},d,n[2]);switch(p){case 1:c=L.circleMarker(u,b);b.radius_in_pixels&&c.setRadius(+b.radius_in_pixels);add_feature(i,c,s,r);break;case 2:b["color"]=b["fillColor"];c=L.polyline(u,b);add_feature(i,c,s,r);break;case 3:c=L.polygon(u,b);add_feature(i,c,s,r);break;case 4:for(var f=0;f<u.length;f++){c=L.circleMarker(u[f],b);b.radius_in_pixels&&c.setRadius(+b.radius_in_pixels);add_feature(i,c,s,r)}break;case 5:b["color"]=b["fillColor"];for(var f=0;f<u.length;f++){c=L.polyline(u[f],b);add_feature(i,c,s,r)}break;case 6:for(var f=0;f<u.length;f++){c=L.polygon(u[f],b);add_feature(i,c,s,r)}break}}if(i.length){o.fitBounds(L.featureGroup(i).addTo(o).getBounds(),{animate:false}).on("click",function(){$("#"+r).hide()})}}function add_feature(e,a,t,r){a.geotable={table_id:r,tbody_id:r.replace("-table","-row")+t};a.on("click",function(e){var a=this.geotable;var t=$("#"+a.tbody_id).show();$("#"+a.table_id+" tbody").not(t).hide();$("#"+a.table_id).show();L.DomEvent.stopPropagation(e)});e.push(a)}$(".geotable-upload").on("uploaded.ir",function(e,a){import_upload(e,a,CC.geotable.import_url,function(e,a){var t=a.find("script").text();var r=$.trim(t.replace(/'/g,'"').replace(/.* = /,"")).slice(0,-1);draw_map(a.attr("id"),$.parseJSON(r))})});
